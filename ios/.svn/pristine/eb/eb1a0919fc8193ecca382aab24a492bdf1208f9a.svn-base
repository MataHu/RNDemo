//
//  PersonalInformationViewController.m
//  Cash
//
//  Created by é™ˆæµ©åœ on 2017/9/15.
//  Copyright Â© 2017å¹´ é™ˆæµ©åœ. All rights reserved.
//

#import "PersonalInformationViewController.h"
#import <AVFoundation/AVFoundation.h>
#import "NickNameViewController.h"

@interface PersonalInformationViewController ()<UIImagePickerControllerDelegate,UINavigationControllerDelegate>
@property (weak, nonatomic) IBOutlet UIImageView *iconImageView;

@end

@implementation PersonalInformationViewController

-(void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    self.iconImageView.layer.cornerRadius = self.iconImageView.height * 0.5;
    self.iconImageView.layer.masksToBounds = YES;
}

- (void)viewDidLoad {
    [super viewDidLoad];
    self.navigationItem.title = @"ä¸ªäººä¿¡æ¯";
    self.tableView.tableFooterView = [[UIView alloc] init];

}

#pragma mark UITableViewDelegate
/**
 è®¾ç½®å°¾éƒ¨å’Œå¤´éƒ¨èƒŒæ™¯é¢œè‰²
 */
- (void)tableView:(UITableView *)tableView willDisplayFooterView:(UIView *)view forSection:(NSInteger)section

{
    view.tintColor = UIColorFromRGB(0xE1E1E1);
}

-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    switch (indexPath.section) {
        case 0:
            //ç¬¬ä¸€ç»„
            switch (indexPath.row) {
                case 0:
                    //å¤´åƒ
                    NSLog(@"å¤´åƒ");
                    [self modifyHeadshot];
                    break;
                case 1:
                    //æ˜µç§°
                     NSLog(@"æ˜µç§°");
                {
                    NickNameViewController *nickVc = [[NickNameViewController alloc] init];
                    [self.navigationController pushViewController:nickVc animated:YES];
                }
                    break;
                default:
                    break;
            }
            break;
        case 1:
            //ç¬¬äºŒç»„
            switch (indexPath.row) {
                case 0:
                    //çœŸå®å§“å
                     NSLog(@"çœŸå®å§“å");
                    break;
                case 1:
                    //æ‰‹æœºå·ç 
                     NSLog(@"æ‰‹æœºå·ç ");
                    break;
                default:
                    break;
            }
            break;
        case 2:
            //ç¬¬ä¸‰ç»„
            switch (indexPath.row) {
                case 0:
                    //èº«ä»½è¯å·
                     NSLog(@"èº«ä»½è¯å·");
                    break;
                case 1:
                    //é“¶è¡Œå¡å·
                     NSLog(@"é“¶è¡Œå¡å·");
                    break;
                default:
                    break;
            }
            break;
        default:
            break;
    }
}

/**
 ä¿®æ”¹å¤´åƒ
 */
- (void)modifyHeadshot {
    /*å¤´åƒ*/
    NSString *mediaType = AVMediaTypeVideo;
    AVAuthorizationStatus authorizationStatus = [AVCaptureDevice authorizationStatusForMediaType:mediaType];
    if (authorizationStatus == AVAuthorizationStatusRestricted || authorizationStatus == AVAuthorizationStatusDenied) {
        /*è¯¢é—®æ˜¯å¦å…è®¸ä½¿ç”¨ç…§ç›¸æœº*/
        UIAlertController * alertC = [UIAlertController alertControllerWithTitle:@"æ‘„åƒå¤´è®¿é—®å—é™" message:@"è¯·å»è®¾ç½®ä¸­ä¿®æ”¹æƒé™" preferredStyle:UIAlertControllerStyleAlert];
        [self presentViewController:alertC animated:YES completion:nil];
        
        UIAlertAction *action = [UIAlertAction actionWithTitle:@"å–æ¶ˆ" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {
            [self dismissViewControllerAnimated:YES completion:nil];
        }];
        [alertC addAction:action];
    }else{
        UIAlertController *alertController = [[UIAlertController alloc] init];
        UIAlertAction *action1 = [UIAlertAction actionWithTitle:@"ä»æ‰‹æœºç›¸å†Œé€‰æ‹©" style:0 handler:^(UIAlertAction * _Nonnull action) {
            
            // åˆ›å»ºå›¾ç‰‡é€‰æ‹©æ§åˆ¶å™¨å¯¹è±¡
            UIImagePickerController *imagePickerController = [[UIImagePickerController alloc] init];
            imagePickerController.navigationBar.tintColor = [UIColor whiteColor];
            // è®¾ç½®å…è®¸ç¼–è¾‘(ç…§ç‰‡)
            imagePickerController.allowsEditing = YES;
            // è®¾ç½®ç›¸å†Œçš„å‘ˆç°æ ·å¼
            imagePickerController.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;
            // è®¾ç½®ä»£ç†
            imagePickerController.delegate = self;
            // å‘ˆç°
            [[UIApplication sharedApplication].keyWindow.rootViewController presentViewController:imagePickerController animated:YES completion:nil];
        }];
        
        UIAlertAction *action2 = [UIAlertAction actionWithTitle:@"æ‹ç…§" style:0 handler:^(UIAlertAction * _Nonnull action) {
            // åˆ›å»ºå›¾ç‰‡é€‰æ‹©æ§åˆ¶å™¨å¯¹è±¡
            UIImagePickerController *imagePickerController = [UIImagePickerController new];
            imagePickerController.navigationBar.tintColor = [UIColor whiteColor];
            // è®¾ç½®å…è®¸ç¼–è¾‘
            imagePickerController.allowsEditing = YES;
            // è®¾ç½®ç›¸å†Œçš„å‘ˆç°æ ·å¼ ---> ä»ğŸ“·ä¸­
            imagePickerController.sourceType = UIImagePickerControllerSourceTypeCamera;
            // è®¾ç½®ä»£ç†
            imagePickerController.delegate = self;
            // å‘ˆç°
            [[UIApplication sharedApplication].keyWindow.rootViewController presentViewController:imagePickerController animated:YES completion:nil];
        }];
        
        UIAlertAction *action3 = [UIAlertAction actionWithTitle:@"å–æ¶ˆ" style:1 handler:^(UIAlertAction * _Nonnull action) {
        }];
        [alertController addAction:action2];
        [alertController addAction:action1];
        [alertController addAction:action3];
        [[UIApplication sharedApplication].keyWindow.rootViewController presentViewController:alertController animated:YES completion:nil];
        
    }
}
/**
 å›¾ç‰‡è¿”å›ä»£ç†æ–¹æ³•
 */
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary<NSString *,id> *)info{
    //ä¸Šä¼ å›¾ç‰‡
    // å°†å›¾ç‰‡å˜æˆdata,dataè¿›è¡Œbase64ç¼–ç æˆå­—ç¬¦ä¸²
    UIImage *resultImage = info[@"UIImagePickerControllerEditedImage"];
    self.iconImageView.image = resultImage;
    NSData *imageData = UIImageJPEGRepresentation(resultImage, 0.1);
    NSString *str = [imageData base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength];
    [picker dismissViewControllerAnimated:YES completion:nil];

    
}
@end
